# 修改日志

本文件记录小说辅助创作工具项目的所有重要变更。

## [Unreleased]

### 新增
- 创建项目设计文档
- 创建数据库设计文档
- 创建项目结构文档
- 创建UI设计文档
- 创建开发步骤文档，用于跟踪项目开发进度
- 创建项目进度报告，总结当前项目状态和下一步建议
- 添加Cursor规则文件
- 添加.npmrc配置文件，设置国内镜像源
- 添加富文本编辑器相关依赖
- 添加Immutable.js依赖
- 添加Electron IPC通信的TypeScript类型定义
- 添加数据库初始化状态检查机制
- 添加数据库表存在性检查功能
- 创建人物管理页面占位组件
- 创建地点管理页面占位组件
- 创建大纲管理页面占位组件
- 创建时间线页面占位组件
- 创建辅助工具页面占位组件
- 创建统计分析页面占位组件
- 创建AI助手页面占位组件
- 实现地点管理模块，包括地点列表、添加/编辑表单和详情页
- 实现大纲管理模块，包括树形结构展示、添加/编辑表单
- 创建地点和大纲的IPC处理器，实现CRUD操作
- 创建地点和大纲的类型定义和服务层
- 实现地点和大纲的状态管理
- 创建创作工具页面，整合地点和大纲管理功能
- 实现人物管理模块，包括人物列表、添加/编辑表单和详情页
- 实现时间线管理模块，包括事件列表、添加/编辑表单
- 创建人物和时间线的IPC处理器，实现CRUD操作
- 创建人物和时间线的类型定义和服务层
- 更新CharactersPage和TimelinePage，集成人物管理和时间线管理功能
- 实现小说导入功能，支持TXT和JSON格式
- 实现小说导出功能，支持TXT和JSON格式
- 实现章节树形结构展示
- 实现章节拖拽排序功能，支持调整顺序和父子关系
- 实现章节合并功能，支持将两个章节合并为一个
- 实现章节拆分功能，支持在指定位置将章节拆分为两个
- 创建标签和分类管理页面，支持添加、编辑和删除标签与分类
- 实现小说关联功能，支持将人物、地点、大纲和时间线关联到小说
- 创建novelAssociationService服务，管理小说与其他实体的关联关系
- 创建novel-association-handler.js，处理关联关系的IPC请求
- 更新NovelDetail组件，添加关联内容标签页，展示和管理关联的人物、地点、大纲和时间线
- 创建EditorSidebar组件，在编辑模式下显示关联的人物、地点、大纲和时间线
- 更新编辑器界面，添加侧边栏切换功能
- 优化编辑器主题系统，支持对不同界面区域应用不同样式
- 完善小说关联功能，添加大纲和时间线的关联和解除关联功能
- 实现大纲树状结构展示功能，支持在关联大纲时自动关联所有子节点
- 优化大纲在编辑器侧边栏和小说详情页的展示方式，使用树形结构直观展示大纲层级关系
- 创建清空大纲和时间线数据的脚本，用于重置测试环境
- 实现数据备份与恢复功能，支持将数据库和资源文件打包为zip文件
- 创建备份页面，提供用户友好的备份与恢复界面
- 实现统计分析功能，包括总体统计、小说进度和写作活动分析
- 完善小说详情页，添加统计分析标签页和备份功能
- 实现AI接口集成，支持多种AI提供商
  - 添加OpenAI API支持，集成GPT-3.5和GPT-4模型
  - 添加DeepSeek API支持，支持DeepSeek Chat和Coder模型
  - 添加Ollama本地模型支持，可与本地大语言模型通信
  - 添加LM Studio本地模型支持，扩展本地模型选择
  - 添加OpenAI兼容API支持，可接入符合OpenAI标准的第三方服务或自部署服务
- 创建AI模块的基础架构
  - 设计AI提供商接口，实现统一的服务抽象
  - 实现AI服务管理器，支持动态切换不同AI提供商
  - 创建聊天服务，提供会话管理和消息发送功能
  - 创建AI设置组件，支持配置不同AI提供商的参数
  - 实现API密钥管理，确保安全存储敏感信息
- 完善AI助手功能
  - 创建会话管理组件，支持创建、切换、重命名和删除会话
  - 实现创作提示词管理，支持添加、编辑、删除和使用提示词
  - 添加提示词分类和标签功能，方便用户组织和查找提示词
  - 实现AI响应流式传输，提供更好的用户体验
  - 添加取消生成功能，允许用户中断长时间的AI生成
  - 添加会话管理侧边栏，方便切换不同的聊天会话
  - 添加取消生成按钮，提高用户控制能力

### 修改
- 更新ToolsPage组件，将人物管理从"开发中"状态更改为"已完成"状态
- 将OpenAI依赖版本从^6.0.0更新为^4.24.1
- 将react-flow-renderer依赖更改为reactflow
- 切换为使用Yarn管理依赖
- 配置网络设置以解决依赖安装问题
- 启用Electron的contextIsolation并配置正确的预加载脚本
- 更新webpack开发服务器配置，支持热重载
- 完善Content Security Policy配置，使用中间件动态设置
- 优化webpack配置，使用source-map提升开发体验
- 改进开发服务器日志和错误提示配置
- 更新TypeScript配置，添加类型定义路径
- 改进数据库管理器，添加初始化状态跟踪
- 优化IPC处理器，确保数据库操作前等待初始化完成
- 更新App.tsx，添加所有页面的路由配置
- 更新MainLayout.tsx，实现菜单导航功能
- 优化地点管理UI，使用卡片式布局展示地点列表
- 优化大纲管理UI，使用树形结构展示大纲层级关系
- 改进表单组件，添加验证和提示信息
- 更新LocationsPage组件，直接集成LocationManager功能
- 更新OutlinesPage组件，直接集成OutlineManager功能
- 更新ToolsPage组件，显示已完成功能的状态，添加地点管理和大纲管理的功能卡片
- 在main.js中添加地点和大纲的IPC处理器导入，解决IPC通信问题
- 在main.js中添加人物和时间线的IPC处理器导入和初始化，解决IPC通信问题
- 更新main.js，添加小说关联处理器的导入和初始化
- 重构NovelDetail组件，使用选项卡布局，分离基本信息、章节管理和关联内容
- 改进novel-association-handler.js中的get-novel-outlines处理程序，支持返回树状结构的大纲数据
- 优化NovelDetail组件中的大纲展示，使用Tree组件替代列表，更直观地展示大纲层级关系
- 修改大纲和时间线解除关联的处理方法，使用临时ID代替null值，解决数据库NOT NULL约束问题
- 修改关联机制，从直接修改大纲和时间线的novel_id字段改为使用relationships表存储关联关系
- 优化小说详情页布局，添加统计分析标签页和备份功能按钮
- 更新MainLayout.tsx，添加备份与恢复菜单项
- 完善统计分析页面，实现数据可视化和交互功能
- 重构AI助手页面
  - 将简单的提示词按钮替换为完整的提示词管理系统
  - 优化聊天界面布局，增加响应式设计
  - 改进消息展示样式，提高可读性
  - 添加会话管理侧边栏，方便切换不同的聊天会话
  - 添加取消生成按钮，提高用户控制能力

### 修复
- 修复"Refused to connect because it violates the document's Content Security Policy"错误，更新CSP配置允许连接到AI服务API
- 优化OpenAI Compatible服务，避免请求模型列表，解决CSP限制问题
- 修复删除对话后创建多个空对话的问题，优化会话管理逻辑
- 修复Ant Design过时API警告，包括Tabs.TabPane和Dropdown.overlay
- 增强CSP配置，允许所有HTTPS连接，彻底解决API连接问题
- 改进OpenAI Compatible服务的URL处理和连接测试逻辑，提高健壮性
- 修复AI服务中"Range of max_tokens should be [1, 8192]"的错误，通过确保max_tokens参数值在有效范围内
- 修复空对话发送消息时产生两条相同语句的问题
- 修复"It looks like you're running in a browser-like environment"错误，在OpenAI客户端配置中添加dangerouslyAllowBrowser选项
- 优化AI助手页面，当检测到缺少API密钥时自动跳转到AI设置页面

### 删除
- 无

## [0.1.0] - 2023-05-13

### 新增
- 初始版本发布
- 实现基本的Electron应用框架
- 添加React前端界面
- 集成SQLite数据库
- 实现小说管理基础功能
- 实现章节编辑基础功能

## [0.2.0] - 2023-08-30

### 新增
- 实现人物关系图谱功能
  - 使用D3.js实现力导向图可视化
  - 支持拖拽交互和节点高亮
  - 显示人物之间的关系类型
- 实现地点地图可视化功能
  - 显示带坐标的地点列表
  - 支持按重要性分类显示
  - 为未来集成完整地图功能做准备
- 完善统计分析功能
- 添加人物和地点的数据关联

### 修改
- 优化人物管理界面，添加关系图谱标签页
- 优化地点管理界面，添加地点地图标签页
- 改进数据库查询性能
- 更新文档和开发步骤

### 修复
- 修复人物创建和编辑的数据验证问题
- 修复地点坐标数据解析错误
- 解决部分UI组件的样式冲突

## [0.3.0] - 2023-08-30

### 新增
- 实现了人物管理功能
- 实现了地点管理功能
- 实现了大纲管理功能
- 实现了时间线管理功能
- 添加了小说关联功能，支持将人物、地点、大纲和时间线关联到小说
- 添加了小说详情页的关联内容标签页
- 添加了编辑器侧边栏，在编辑模式下显示关联的人物、地点、大纲和时间线

### 修改
- 优化了小说详情页的布局，使用选项卡分离内容
- 改进了人物和地点的展示方式，使用卡片式布局
- 优化了编辑器界面，添加侧边栏切换功能

### 修复
- 修复了一些数据关联问题

## [0.4.0] - 2023-06-20

### 新增
- 添加了编辑器侧边栏，可以查看关联的人物、地点、大纲和时间线
- 完成了地点、大纲和时间线关联功能

### 修改
- 改进了编辑器界面布局
- 优化了主题颜色管理

### 修复
- 修复了大纲和时间线关联到小说后在原模块中消失的问题
- 修复了大纲父子关系在关联时不正确的问题
- 修复了关联功能导致数据丢失的问题

## 版本规范

本项目遵循[语义化版本控制](https://semver.org/lang/zh-CN/)规范：

- 主版本号：不兼容的API变更
- 次版本号：向后兼容的功能性新增
- 修订号：向后兼容的问题修正 