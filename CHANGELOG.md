# 修改日志

本文件记录小说辅助创作工具项目的所有重要变更。

## [未发布]

### 新增
- 创建项目设计文档
- 创建数据库设计文档
- 创建项目结构文档
- 创建UI设计文档
- 创建开发步骤文档，用于跟踪项目开发进度
- 创建项目进度报告，总结当前项目状态和下一步建议
- 添加Cursor规则文件
- 添加.npmrc配置文件，设置国内镜像源
- 添加富文本编辑器相关依赖
- 添加Immutable.js依赖
- 添加Electron IPC通信的TypeScript类型定义
- 添加数据库初始化状态检查机制
- 添加数据库表存在性检查功能
- 创建人物管理页面占位组件
- 创建地点管理页面占位组件
- 创建大纲管理页面占位组件
- 创建时间线页面占位组件
- 创建辅助工具页面占位组件
- 创建统计分析页面占位组件
- 创建AI助手页面占位组件
- 实现地点管理模块，包括地点列表、添加/编辑表单和详情页
- 实现大纲管理模块，包括树形结构展示、添加/编辑表单
- 创建地点和大纲的IPC处理器，实现CRUD操作
- 创建地点和大纲的类型定义和服务层
- 实现地点和大纲的状态管理
- 创建创作工具页面，整合地点和大纲管理功能
- 实现人物管理模块，包括人物列表、添加/编辑表单和详情页
- 实现时间线管理模块，包括事件列表、添加/编辑表单
- 创建人物和时间线的IPC处理器，实现CRUD操作
- 创建人物和时间线的类型定义和服务层
- 更新CharactersPage和TimelinePage，集成人物管理和时间线管理功能
- 实现小说导入功能，支持TXT和JSON格式
- 实现小说导出功能，支持TXT和JSON格式
- 实现章节树形结构展示
- 实现章节拖拽排序功能，支持调整顺序和父子关系
- 实现章节合并功能，支持将两个章节合并为一个
- 实现章节拆分功能，支持在指定位置将章节拆分为两个
- 创建标签和分类管理页面，支持添加、编辑和删除标签与分类
- 实现小说关联功能，支持将人物、地点、大纲和时间线关联到小说
- 创建novelAssociationService服务，管理小说与其他实体的关联关系
- 创建novel-association-handler.js，处理关联关系的IPC请求
- 更新NovelDetail组件，添加关联内容标签页，展示和管理关联的人物、地点、大纲和时间线
- 创建EditorSidebar组件，在编辑模式下显示关联的人物、地点、大纲和时间线
- 更新编辑器界面，添加侧边栏切换功能
- 优化编辑器主题系统，支持对不同界面区域应用不同样式
- 完善小说关联功能，添加大纲和时间线的关联和解除关联功能
- 实现大纲树状结构展示功能，支持在关联大纲时自动关联所有子节点
- 优化大纲在编辑器侧边栏和小说详情页的展示方式，使用树形结构直观展示大纲层级关系
- 创建清空大纲和时间线数据的脚本，用于重置测试环境

### 修改
- 将OpenAI依赖版本从^6.0.0更新为^4.24.1
- 将react-flow-renderer依赖更改为reactflow
- 切换为使用Yarn管理依赖
- 配置网络设置以解决依赖安装问题
- 启用Electron的contextIsolation并配置正确的预加载脚本
- 更新webpack开发服务器配置，支持热重载
- 完善Content Security Policy配置，使用中间件动态设置
- 优化webpack配置，使用source-map提升开发体验
- 改进开发服务器日志和错误提示配置
- 更新TypeScript配置，添加类型定义路径
- 改进数据库管理器，添加初始化状态跟踪
- 优化IPC处理器，确保数据库操作前等待初始化完成
- 更新App.tsx，添加所有页面的路由配置
- 更新MainLayout.tsx，实现菜单导航功能
- 优化地点管理UI，使用卡片式布局展示地点列表
- 优化大纲管理UI，使用树形结构展示大纲层级关系
- 改进表单组件，添加验证和提示信息
- 更新LocationsPage组件，直接集成LocationManager功能
- 更新OutlinesPage组件，直接集成OutlineManager功能
- 更新ToolsPage组件，显示已完成功能的状态，添加地点管理和大纲管理的功能卡片
- 在main.js中添加地点和大纲的IPC处理器导入，解决IPC通信问题
- 在main.js中添加人物和时间线的IPC处理器导入和初始化，解决IPC通信问题
- 更新main.js，添加小说关联处理器的导入和初始化
- 重构NovelDetail组件，使用选项卡布局，分离基本信息、章节管理和关联内容
- 改进novel-association-handler.js中的get-novel-outlines处理程序，支持返回树状结构的大纲数据
- 优化NovelDetail组件中的大纲展示，使用Tree组件替代列表，更直观地展示大纲层级关系
- 修改大纲和时间线解除关联的处理方法，使用临时ID代替null值，解决数据库NOT NULL约束问题
- 修改关联机制，从直接修改大纲和时间线的novel_id字段改为使用relationships表存储关联关系

### 修复
- 修复依赖安装过程中的网络连接问题
- 解决证书验证错误
- 修复contextBridge API使用问题
- 解决开发环境下的CSP限制问题
- 修复webpack-dev-server的WebSocket连接问题
- 修复CSP配置不一致导致的unsafe-eval错误
- 修复缺失的编辑器依赖问题
- 修复NovelDetail组件中的中文引号问题
- 修复window.electron类型定义缺失问题
- 修复HTML页面为空的问题，调整CSP配置允许unsafe-eval
- 修复React应用不加载的问题，添加加载提示
- 修复数据库表不存在错误，实现表结构检查和自动创建
- 修复数据库查询前未等待初始化完成的问题
- 修复大纲树形结构的递归删除问题
- 修复webpack构建错误，添加Node.js核心模块的polyfill
- 修复服务层中直接导入electron模块的问题，改用window.electron
- 修复"Error invoking remote method"错误，添加缺失的IPC处理器导入
- 修复大纲创建时的SQL参数错误（SQLITE_RANGE: column index out of range），优化参数处理逻辑
- 修复timeline_events表结构问题，添加缺失的importance列，并将related_characters和related_locations列名更新为character_ids和location_id
- 修复updateTimelineEventsTable方法中的回调函数处理，确保在表结构更新后正确调用createIndexes并传递回调
- 修复数据库中缺少novel_tags表的问题，添加表结构检查和创建逻辑
- 修复NovelDetail组件中对可能为undefined的属性的访问问题
- 修复 Ant Design 的 message 组件动态主题警告，使用 App 组件包装相关组件
- 修复大纲关联功能中的类型错误，确保正确处理大纲的树状结构
- 修复解除大纲和时间线关联时的NOT NULL约束错误，使用临时ID替代null值
- 修复大纲和时间线解除关联时的错误处理和消息提示
- 修复关联到小说的大纲和时间线在原模块中消失的问题，改为使用relationships表存储关联关系
- 修复大纲的父子关系不正确问题，确保子节点随父节点正确绑定到小说
- 修复OutlineList组件中的数据加载逻辑，显示所有大纲而非仅关联到当前小说的大纲
- 修复TimelineList组件中的数据加载逻辑，显示所有时间线事件
- 修复novel-association-handler.js中的查询逻辑，使用JOIN查询relationships表获取关联数据

### 删除
- 无

## [0.1.0] - 2023-05-13

### 新增
- 实现基本的Electron应用框架
- 添加React前端界面
- 集成SQLite数据库
- 实现小说管理基础功能
- 实现章节编辑基础功能

## [0.2.0] - 2023-08-15

### 新增
- 添加了小说分类与标签管理功能
- 实现了编辑器自动保存功能
- 添加了章节内容版本历史记录和恢复功能
- 实现了编辑器主题切换功能

### 修改
- 优化了编辑器界面，添加了更多功能按钮
- 改进了编辑器的用户体验

### 修复
- 修复了一些界面显示问题

## [0.3.0] - 2023-08-30

### 新增
- 实现了人物管理功能
- 实现了地点管理功能
- 实现了大纲管理功能
- 实现了时间线管理功能
- 添加了小说关联功能，支持将人物、地点、大纲和时间线关联到小说
- 添加了小说详情页的关联内容标签页
- 添加了编辑器侧边栏，在编辑模式下显示关联的人物、地点、大纲和时间线

### 修改
- 优化了小说详情页的布局，使用选项卡分离内容
- 改进了人物和地点的展示方式，使用卡片式布局
- 优化了编辑器界面，添加侧边栏切换功能

### 修复
- 修复了一些数据关联问题

## [0.4.0] - 2023-06-20

### 新增
- 添加了编辑器侧边栏，可以查看关联的人物、地点、大纲和时间线
- 完成了地点、大纲和时间线关联功能

### 修改
- 改进了编辑器界面布局
- 优化了主题颜色管理

### 修复
- 修复了大纲和时间线关联到小说后在原模块中消失的问题
- 修复了大纲父子关系在关联时不正确的问题
- 修复了关联功能导致数据丢失的问题

## 版本规范

本项目遵循[语义化版本控制](https://semver.org/lang/zh-CN/)规范：

- 主版本号：不兼容的API变更
- 次版本号：向后兼容的功能性新增
- 修订号：向后兼容的问题修正 