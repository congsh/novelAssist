# 变更日志

所有对项目的重要更改都将记录在此文件中。

## [未发布] - 2025-05-22

### 新增
- 在AI服务基础接口中添加createEmbedding方法支持
- 为OpenAI服务和OpenAI兼容服务实现embedding功能
- 支持使用OpenAI API生成文本嵌入向量
- 为AI模型添加嵌入模型标识，支持在UI中管理嵌入模型
- 自动为OpenAI和OpenAI兼容服务添加默认嵌入模型
- 优化向量嵌入服务，优先使用标记为嵌入模型的模型

### 修改
- 移除默认AI配置，当用户未配置AI时，使用空设置
- 添加AI配置检查机制，当需要使用AI功能但未配置时，自动提示用户进行配置
- 修改AI服务初始化流程，确保在AI服务未配置时不会尝试初始化
- 为各个使用AI功能的界面增加配置状态检查，提高用户体验
- 优化AI服务管理器，添加更严格的提供商ID有效性检查

### 修复
- 修复了多处依赖default-openai配置的代码，彻底清除对默认OpenAI配置的依赖
- 改进了各组件的AI配置检查，确保所有组件在AI未配置时能正确提示用户
- 修复了AIEditorService、AIModelManager和AISettings组件中的初始化和测试连接逻辑
- 解决了AI服务管理器在未配置时仍尝试查找default-openai服务的问题
- 修复了AISettings组件中测试连接功能使用default-openai的问题
- 增强了AIAssistantPage的错误处理，在初始化失败时直接跳转到设置页面
- 修复了OpenAI兼容服务(openai_compatible)未正确注册到AI服务管理器的问题，导致找不到对应提供商服务实现
- 修复了AI场景设置(AIScenarioSettings)表单验证问题，现在未启用的场景不再要求填写提供商和模型
- 改进了向量数据库服务的进程管理，确保应用关闭时彻底清理Python进程
- 增强了stopPythonProcess方法，添加了端口占用检测和额外清理逻辑
- 修复了多个Python进程残留导致端口冲突的问题
- 修复了Windows平台下taskkill命令输出乱码问题
- 优化了进程终止逻辑，避免尝试终止系统关键进程(PID 0, 4等)
- 完善了端口占用检测和清理流程，提高了服务关闭的可靠性
- 修复了AI助手聊天界面中的IPC处理器注册问题，确保调用registerAIHandlers函数
- 优化了聊天服务错误处理，当保存或获取聊天会话失败时不影响用户体验
- 增强了聊天界面的健壮性，当后端服务不可用时提供降级体验

## [未发布] - 2025-05-21

### 新增
- 添加命令行参数 `--dev-tools` 支持，允许在任何环境下通过命令行参数打开开发者工具

## [0.1.0] - 2023-05-13

### 新增
- 基本的Electron应用框架
- React前端界面
- SQLite数据库集成
- 小说管理基础功能
- 章节编辑基础功能

## [0.3.0] - 2023-08-15

### 新增
- 人物管理功能
- 地点管理功能
- 大纲管理功能
- 时间线管理功能

## [0.5.0] - 2023-08-30

### 新增
- 小说与人物、地点、大纲、时间线的关联功能
- 小说详情页关联内容标签页

## [0.7.0] - 2023-09-15

### 新增
- 人物关系图谱功能(D3.js可视化)
- 地点地图可视化功能

## [0.9.0] - 2023-11-30

### 新增
- AI服务架构设计
- 多API集成(OpenAI、DeepSeek、Ollama、LM Studio、OpenAI兼容API)
- 聊天会话管理
- 创作提示词系统
- AI场景配置与模型管理
- 数据备份与恢复功能

## [0.9.5] - 2024-05-20

### 新增
- 编辑器AI功能基础架构
- 编辑器AI服务
- 文本差异对比组件
- 编辑器AI面板组件

## [0.9.9] - 2024-06-01

### 新增
- 文本润色功能
- 文本续写功能
- 角色/地点创建功能
- 大纲修改功能
- 时间线添加功能

### 优化
- AI设置界面简化
- AI助手页面重新设计
- 编辑器AI面板简化
- 错误处理和操作反馈改进
- 按钮样式和交互模式统一

### 修复
- OpenAI兼容API设置中的重复默认模型字段问题
- 编辑器无法正确获取选中文本的问题
- 编辑器AI助手"AI服务未初始化"错误

## [0.1.0] - 2025-05-20

### 修复
- 修复了向量数据库服务依赖问题，移除了sentencepiece依赖
- 成功启动Chroma向量数据库服务，端口为8000
- 修复了主应用中vector-manager模块导入错误，重构为JavaScript版本

### 新增
- 初始化了向量数据库存储目录(resources/vector_db)
- 添加了向量数据库服务启动批处理脚本

## [0.1.0] - 2025-05-21

### 修复
- 修复了向量数据库服务依赖问题，移除了sentencepiece依赖
- 成功启动Chroma向量数据库服务，端口为8000
- 修复了主应用中vector-manager模块导入错误，重构为JavaScript版本
- 修复了 'get-novels' IPC处理器重复注册的问题
- 修复了统计相关IPC处理器未正确注册的问题，包括get-writing-activity和get-writing-time
- 优化了Dashboard组件，增加了错误处理以提高稳定性

### 新增
- 初始化了向量数据库存储目录(resources/vector_db)
- 添加了向量数据库服务启动批处理脚本
- 添加了写作时间估算功能

## [0.8.0] - 2023-11-15

### 新增
- 实现内容向量化系统
  - 创建向量化服务核心架构
  - 实现文本分块和处理策略
  - 集成词向量嵌入服务
  - 添加OpenAI/DeepSeek嵌入API支持
- 实现小说内容的向量化索引
  - 为每个章节创建向量化表示
  - 为章节中的场景和对话创建独立向量
  - 实现自动更新机制，在内容改变时更新向量
  - 创建向量缓存系统，提升查询性能
- 添加小说详情页中的"向量化章节"功能按钮

### 修改
- 优化向量嵌入服务，提升性能和稳定性
- 改进AI服务架构，支持向量化和检索功能

### 修复
- 修复AI设置中的服务初始化问题
- 解决向量数据库连接稳定性问题

## [未发布]

### 新增
- 向量化索引与上下文增强实现
  - 确定使用Chroma作为向量数据库
  - 开发Python Chroma服务，提供RESTful API
  - 实现向量数据库服务与Electron主进程集成
  - 完善VectorEmbeddingService，支持文本向量化及存储
  - 重构ContextSearchService，实现真实向量检索
- Embedding模型实现计划
- Agent架构实现计划

### 优化
- 富文本编辑器性能优化
- AI响应速度和稳定性优化
- 用户界面一致性与易用性改进
- 应用打包流程优化

### 修复
- 修复VectorEmbeddingService中的类型错误
  - 添加缺失的embedding字段，确保与vector字段保持一致
  - 修复元数据类型定义，使用Partial类型提高灵活性
  - 为必要的元数据字段提供默认值，确保类型安全
- 修复向量嵌入服务未初始化问题
  - 添加自动初始化功能，从服务管理器获取设置
  - 改进错误提示信息，提高调试便捷性
- 修复Python向量服务日志中文乱码问题
  - 设置stdout和stderr的编码为UTF-8
  - 优化日志处理器配置
- 修复Python向量服务端口冲突问题
  - 添加自动端口选择功能，当默认端口被占用时自动寻找可用端口
  - 改进端口检测机制，确保服务稳定启动
  - 优化服务启动流程，增强错误处理