# 小说辅助创作工具开发步骤文档

本文档记录项目开发的主要步骤和进度。

## 已完成步骤

### 1. 项目初始化与基础架构
- [x] 创建Electron项目
- [x] 配置React前端环境
- [x] 设置TypeScript
- [x] 配置webpack构建系统
- [x] 实现主进程和渲染进程通信

### 2. 数据库设计与实现
- [x] 设计数据库结构
- [x] 实现数据库管理器
- [x] 创建数据表和初始化脚本
- [x] 实现数据CRUD操作

### 3. 小说管理功能
- [x] 实现小说创建、编辑、删除功能
- [x] 实现小说列表展示
- [x] 实现小说导入导出功能
- [x] 实现小说详情页

### 4. 章节管理功能
- [x] 实现章节创建、编辑、删除功能
- [x] 实现章节树形结构展示
- [x] 实现章节拖拽排序
- [x] 实现章节合并和拆分功能

### 5. 富文本编辑器
- [x] 集成Draft.js编辑器
- [x] 实现基本文本编辑功能
- [x] 实现格式化工具栏
- [x] 实现内容保存和加载

### 6. 创作辅助工具
- [x] 实现人物管理功能
- [x] 实现地点管理功能
- [x] 实现大纲管理功能
- [x] 实现时间线管理功能

### 7. 实体关联系统
- [x] 实现小说与人物关联
- [x] 实现小说与地点关联
- [x] 实现小说与大纲关联
- [x] 实现小说与时间线关联
- [x] 实现编辑器侧边栏展示关联内容

### 8. 数据备份与恢复
- [x] 实现数据库备份功能
- [x] 实现资源文件备份功能
- [x] 实现数据恢复功能
- [x] 创建备份管理界面

### 9. 统计分析功能
- [x] 实现小说总体统计
- [x] 实现写作进度分析
- [x] 实现写作活动分析
- [x] 创建统计分析可视化界面

### 10. AI功能集成
- [x] 集成OpenAI API
- [x] 集成DeepSeek API
- [x] 集成Ollama本地模型
- [x] 集成LM Studio本地模型
- [x] 实现OpenAI兼容API支持
- [x] 创建AI设置界面
- [x] 实现AI聊天助手
- [x] 实现编辑器AI辅助功能
- [x] 创建提示词管理系统
- [x] 实现文本差异对比功能
- [x] 实现AI场景配置系统

### 11. 界面优化
- [x] 优化主界面布局和导航
- [x] 优化小说管理界面
- [x] 优化编辑器界面
- [x] 优化创作工具界面
- [x] 优化AI助手界面
- [x] 优化文本差异对比组件
  - [x] 改进视觉设计，使用卡片式布局
  - [x] 添加差异统计功能，显示新增和删除的字符数及百分比
  - [x] 优化空状态和无变化状态的展示
  - [x] 添加文本差异总结信息
- [x] 优化创作提示词组件
  - [x] 添加高级筛选功能，支持按分类和标签筛选
  - [x] 改进搜索功能，提供更直观的结果展示
  - [x] 使用响应式网格布局展示提示词卡片
  - [x] 优化提示词卡片设计，添加悬停效果和操作按钮
  - [x] 改进空状态展示和用户引导
  - [x] 增强表单体验，添加字数统计和提示信息
- [x] 统一应用界面风格和交互模式

### 12. 性能优化
- [x] 优化富文本编辑器性能
- [x] 优化大型小说文件加载性能
- [x] 优化AI响应速度和稳定性
- [x] 优化应用启动时间

### 13. AI助手优化
- [x] 优化AI设置界面
  - [x] 修复OpenAI兼容API设置中的重复默认模型字段问题
  - [x] 添加配置命名功能，便于识别多个配置
  - [x] 改进界面布局，使其更加直观
  - [x] 完善表单验证和提示
- [x] 优化AI助手页面
  - [x] 重新设计聊天界面，提升整体交互体验
  - [x] 添加快捷键支持(Enter发送/Shift+Enter换行)
  - [x] 优化提示词库访问方式
  - [x] 改进加载状态的视觉反馈
- [x] 优化编辑器AI面板
  - [x] 简化面板界面，减少视觉干扰
  - [x] 添加操作说明，使功能更清晰
  - [x] 改进AI响应的展示方式，使用卡片式布局
  - [x] 增强错误处理和用户提示
- [x] 文本差异对比组件优化
  - [x] 增强视觉效果，改善样式
  - [x] 添加差异统计信息(增删字符数)
  - [x] 使用更清晰的颜色标记和布局

### 14. 富文本编辑器性能优化
- [x] 创建编辑器性能优化工具类
  - [x] 实现防抖自动保存功能
  - [x] 开发大型文档分块加载机制
  - [x] 实现编辑器性能优化函数
  - [x] 添加字数统计和token估算功能
- [x] 优化编辑器服务
  - [x] 重构编辑器服务，集成分块加载和性能优化
  - [x] 改进自动保存机制，减少保存操作频率
  - [x] 优化内容加载过程，添加进度反馈
- [x] 编辑器渲染优化
  - [x] 创建基于虚拟化的编辑器组件
  - [x] 实现滚动优化，减少不必要的重渲染
  - [x] 优化大型文档的编辑流畅度

### 15. AI响应速度和稳定性优化
- [x] 创建AI请求队列系统
  - [x] 实现请求队列和优先级管理
  - [x] 添加请求超时控制机制
  - [x] 实现自动重试和错误恢复功能
- [x] 优化聊天上下文管理
  - [x] 创建聊天上下文管理器
  - [x] 实现智能历史消息压缩
  - [x] 添加Token使用优化功能
  - [x] 实现基于场景的Token限制管理
- [x] 集成优化功能
  - [x] 重构聊天服务，集成请求队列和上下文管理
  - [x] 优化响应流式传输，提高稳定性
  - [x] 改进错误处理机制，增强用户体验

### 16. 向量化索引与上下文增强
- [x] 选择合适的向量数据库
  - [x] 调研并评估Chroma、Milvus和pgvector等向量数据库
  - [x] 验证对Electron桌面应用的兼容性
  - [x] 测试嵌入式部署和性能分析
  - [x] 完成向量数据库选型报告，确定采用Chroma
- [x] 实现内容向量化系统
  - [x] 创建向量化服务核心架构
  - [x] 实现文本分块和处理策略
  - [x] 集成词向量嵌入服务
  - [x] 添加本地嵌入模型支持
  - [x] 添加OpenAI/DeepSeek嵌入API支持
  - [x] 实现向量化任务队列和进度跟踪
- [x] 实现小说内容的向量化索引
  - [x] 为每个章节创建向量化表示
  - [x] 为章节中的场景和对话创建独立向量
  - [x] 实现场景和对话的智能识别分块
  - [x] 实现基于分块类型的相似内容查询
  - [x] 在阅读界面集成场景和对话导航功能
  - [x] 实现自动更新机制，在内容改变时更新向量
  - [x] 创建向量缓存系统，提升查询性能
- [x] 实现实体向量化系统
  - [x] 创建实体向量化服务(EntityVectorService)
  - [x] 实现人物、地点、大纲和时间线的向量化处理
  - [x] 添加批量向量化功能，支持进度跟踪
  - [x] 实现实体向量的查询和相似度搜索
  - [x] 创建实体向量化管理界面
  - [x] 添加向量数据清理和测试功能
  - [x] 在AI助手页面集成实体向量化管理标签页
  - [x] 实现直接向量化按钮和批量处理功能
  - [x] 创建向量化数据展示页面，支持筛选和搜索
  - [x] 添加向量化记录的详情查看、重新处理和删除功能
  - [x] 实现向量化进度实时显示和错误处理
  - [x] 创建数据库表和IPC处理器支持向量化数据管理

## 进行中步骤

### 17. 内容分析模块实现
- [ ] 实现文本特征提取功能
  - [ ] 开发实体识别服务
    - [ ] 实现角色识别与关联
    - [ ] 实现地点识别与关联
    - [ ] 实现事件识别与关联
    - [ ] 实现时间线识别
  - [ ] 开发风格分析功能
    - [ ] 实现写作风格特征提取
    - [ ] 实现语言模式识别
    - [ ] 实现情感基调分析
    - [ ] 实现叙事视角识别
  - [ ] 开发结构分析功能
    - [ ] 实现情节结构识别
    - [ ] 实现叙事节奏分析
    - [ ] 实现冲突点识别
    - [ ] 实现转折点标记
- [ ] 实现内容一致性检查系统
  - [ ] 开发角色一致性检查功能
    - [ ] 实现角色行为一致性检查
    - [ ] 实现角色对话风格一致性检查
    - [ ] 实现角色关系一致性检查
    - [ ] 实现角色发展合理性检查
  - [ ] 开发情节一致性检查功能
    - [ ] 实现情节逻辑检查
    - [ ] 实现时间线一致性检查
    - [ ] 实现设定符合度检查
    - [ ] 实现伏笔与呼应关联检查
  - [ ] 创建一致性问题管理界面
    - [ ] 实现问题列表展示与筛选
    - [ ] 实现问题详情查看
    - [ ] 实现一键修复建议
    - [ ] 实现问题状态跟踪

### 18. 内容生成模块增强
- [ ] 升级文本生成服务
  - [ ] 实现多种内容生成策略
    - [ ] 开发基于提示的生成功能
    - [ ] 开发基于样例的生成功能
    - [ ] 开发风格引导生成功能
    - [ ] 开发多步骤生成流程
  - [ ] 增强生成控制能力
    - [ ] 实现输出格式控制
    - [ ] 实现长度与详细度控制
    - [ ] 实现创意度控制
    - [ ] 实现特定元素包含控制
- [ ] 改进差异比较引擎
  - [ ] 升级文本差异比较功能
    - [ ] 添加语义级差异识别
    - [ ] 添加结构级差异识别
    - [ ] 改进差异可视化展示
  - [ ] 增强差异应用功能
    - [ ] 实现选择性接受机制
    - [ ] 实现合并冲突解决
    - [ ] 实现批量差异处理
    - [ ] 实现差异历史追踪
- [ ] 增强内容修改与润色功能
  - [ ] 改进语言优化能力
    - [ ] 添加语法修正功能
    - [ ] 增强表达优化功能
    - [ ] 实现词汇多样化功能
    - [ ] 实现语言流畅度提升功能
  - [ ] 增强内容增强能力
    - [ ] 添加描写细节增强功能
    - [ ] 添加对话生动化功能
    - [ ] 添加场景氛围强化功能
    - [ ] 添加情感表达丰富化功能
- [ ] 升级续写服务
  - [ ] 实现多种续写模式
    - [ ] 开发大纲引导续写功能
    - [ ] 开发角色驱动续写功能
    - [ ] 开发风格一致续写功能
    - [ ] 开发情节拓展续写功能
  - [ ] 增强生成质量控制
    - [ ] 实现内容连贯性保障机制
    - [ ] 实现风格一致性保障机制
    - [ ] 实现情节合理性评估功能
    - [ ] 实现多轮优化迭代功能

### 19. 上下文增强功能
- [ ] 实现AI上下文增强功能
  - [ ] 创建上下文增强服务架构
  - [ ] 实现智能上下文筛选与整合
  - [ ] 设计上下文压缩与转换策略
  - [ ] 开发上下文框架格式化器
  - [ ] 构建上下文提取与摘要服务
- [ ] 实现创作辅助模块
  - [ ] 开发内联编辑建议功能
    - [ ] 实现实时建议生成
    - [ ] 创建建议展示与交互组件
  - [ ] 开发内容检索增强功能
    - [ ] 实现智能关联检索
    - [ ] 实现检索结果整合
  - [ ] 开发创作灵感触发功能
    - [ ] 实现灵感生成机制
    - [ ] 创建灵感工具组件
- [ ] 创建智能问答系统
  - [ ] 设计问答系统架构
  - [ ] 实现问题分析与意图识别
  - [ ] 创建基于向量和结构的混合检索
  - [ ] 开发答案生成与排序机制
  - [ ] 添加上下文追踪与多轮对话支持

### 20. Agent系统实现
- [ ] 设计Agent系统架构
  - [ ] 创建Agent框架基础结构
  - [ ] 定义Agent接口和通信协议
  - [ ] 设计工具和操作库
  - [ ] 实现Agent状态管理系统
  - [ ] 创建调度和控制机制
- [ ] 实现基础Agent框架
  - [ ] 开发Agent核心架构
    - [ ] 实现基础Agent抽象类
    - [ ] 创建输入/输出处理接口
    - [ ] 开发状态管理机制
    - [ ] 实现能力注册系统
  - [ ] 开发Agent通信机制
    - [ ] 定义标准化消息格式
    - [ ] 实现事件驱动通信
    - [ ] 添加同步/异步交互支持
    - [ ] 创建错误处理与恢复机制
- [ ] 实现预设Agent模块
  - [ ] 开发核心功能型Agent
    - [ ] 实现编辑Agent
    - [ ] 实现风格Agent
    - [ ] 实现角色Agent
    - [ ] 实现续写Agent
    - [ ] 实现读者Agent
  - [ ] 实现Agent能力配置系统
    - [ ] 创建预设能力组合
    - [ ] 定义默认行为规则
    - [ ] 开发标准提示模板
    - [ ] 实现优化参数设置
- [ ] 开发自定义Agent服务
  - [ ] 创建Agent配置系统
    - [ ] 实现配置模板管理
    - [ ] 开发能力选择器
    - [ ] 创建行为规则编辑器
    - [ ] 实现资源分配控制
  - [ ] 实现Agent验证与测试功能
    - [ ] 开发配置有效性验证
    - [ ] 创建能力兼容性检查
    - [ ] 实现性能基准测试
    - [ ] 添加行为一致性测试
- [ ] 开发Agent工作链系统
  - [ ] 创建工作链定义功能
    - [ ] 实现节点与连接定义
    - [ ] 开发数据流配置
    - [ ] 创建条件分支规则
    - [ ] 实现循环与迭代控制
  - [ ] 实现工作链执行功能
    - [ ] 开发执行计划生成
    - [ ] 实现节点调度与执行
    - [ ] 创建状态监控与可视化
    - [ ] 添加中断与恢复机制
  - [ ] 创建工作链管理界面
    - [ ] 实现工作链可视化编辑器
    - [ ] 创建工作链模板库
    - [ ] 开发工作链执行监控界面
    - [ ] 添加执行历史与结果查看

### 21. Embedding模型实现
- [ ] 调研和选择本地Embedding模型
  - [ ] 评估轻量级Embedding模型（如SBERT变体、FastText、GloVe等）
  - [ ] 测试模型在不同语言上的性能，特别是中文
  - [ ] 创建模型评估报告，比较嵌入质量和处理速度
  - [ ] 选择最适合桌面应用的模型
- [ ] 实现Embedding服务架构
  - [ ] 设计统一的Embedding服务接口
  - [ ] 创建模型加载和管理机制
  - [ ] 实现批处理和缓存优化
  - [ ] 开发多线程处理框架，防止UI阻塞
  - [ ] 设计向量存储和索引结构
- [ ] 文本预处理系统
  - [ ] 实现智能分块算法，优化语义完整性
  - [ ] 创建自适应分块大小机制，基于内容复杂度
  - [ ] 实现预处理管道（清洗、分词、规范化）
  - [ ] 添加中文特定的处理规则
  - [ ] 开发关键信息提取和权重分配算法
- [ ] 高级向量检索功能
  - [ ] 实现混合检索策略（BM25+向量相似度）
  - [ ] 创建重排序和结果优化算法
  - [ ] 开发上下文感知检索，考虑查询上下文
  - [ ] 实现语义过滤和聚类功能
  - [ ] 添加个性化检索偏好设置

### 22. 应用打包与安装
- [x] 优化应用打包流程
- [ ] 减小安装包体积
- [ ] 简化安装过程
- [ ] 创建自动更新机制

### 23. 跨平台兼容性
- [ ] Windows平台测试与修复
- [ ] macOS平台测试与修复
- [ ] Linux平台测试与修复
- [ ] 不同屏幕分辨率适配优化

### 24. 用户文档
- [ ] 编写用户使用手册
- [ ] 创建功能介绍视频
- [ ] 编写常见问题解答
- [ ] 创建在线帮助系统

## 计划步骤

### 17. Agent系统基础架构
- [ ] Agent核心架构设计
  - [ ] 设计基础Agent抽象类
  - [ ] 实现输入/输出处理接口
  - [ ] 开发状态管理机制
  - [ ] 创建能力注册系统
- [ ] Agent通信机制
  - [ ] 定义标准化消息格式
  - [ ] 实现事件驱动通信
  - [ ] 添加同步/异步交互支持
  - [ ] 开发错误处理与恢复机制
- [ ] 基础Agent实现
  - [ ] 开发编辑Agent
  - [ ] 开发风格Agent
  - [ ] 开发角色Agent
  - [ ] 开发读者Agent

### 18. 上下文处理框架
- [ ] 上下文构建系统
  - [ ] 实现多源上下文组装
  - [ ] 开发动态上下文优先级
  - [ ] 设计上下文压缩算法
- [ ] Token预算管理
  - [ ] 创建Token计数器
  - [ ] 实现预算分配策略
  - [ ] 开发自动调整机制
- [ ] 上下文缓存系统
  - [ ] 设计缓存结构
  - [ ] 实现LRU缓存策略
  - [ ] 添加缓存失效机制

### 19. 内容一致性检查系统
- [ ] 角色一致性检查
  - [ ] 开发角色行为一致性检查
  - [ ] 实现角色对话风格一致性检查
  - [ ] 创建角色关系一致性检查
- [ ] 情节一致性检查
  - [ ] 开发情节逻辑检查
  - [ ] 实现时间线一致性检查
  - [ ] 创建设定符合度检查
- [ ] 问题管理系统
  - [ ] 设计问题分级机制
  - [ ] 实现问题定位与上下文提供
  - [ ] 开发修复建议生成

### 20. Agent工作链系统
- [ ] 工作链定义系统
  - [ ] 设计节点与连接定义
  - [ ] 实现数据流配置
  - [ ] 开发条件分支规则
  - [ ] 添加循环与迭代控制
- [ ] 工作链执行引擎
  - [ ] 创建执行计划生成器
  - [ ] 实现节点调度与执行
  - [ ] 开发状态监控与可视化
  - [ ] 添加中断与恢复机制
- [ ] 工作链模板系统
  - [ ] 创建预设工作链模板
  - [ ] 实现模板参数化
  - [ ] 开发模板管理界面

### 21. 创作辅助功能增强
- [ ] 内联编辑建议
  - [ ] 实现编辑过程监听
  - [ ] 开发上下文感知分析
  - [ ] 创建智能建议触发机制
  - [ ] 设计内联提示UI
- [ ] 内容检索增强
  - [ ] 开发编辑上下文关联
  - [ ] 实现相关内容推荐
  - [ ] 创建多源信息整合
  - [ ] 设计上下文嵌入展示
- [ ] 创作灵感触发
  - [ ] 开发创意提示生成
  - [ ] 实现问题引导思考
  - [ ] 创建头脑风暴助手
  - [ ] 设计情节分支探索工具

## 开发优先级与时间规划

1. **第一阶段（1-2个月）**：完善向量化系统、增强内容生成功能、实现基础一致性检查
2. **第二阶段（2-3个月）**：开发Agent核心架构、实现基础Agent、创建Agent配置系统
3. **第三阶段（3-4个月）**：完成Agent系统、增强上下文处理框架、集成创作辅助功能

## 注意事项

- 每个功能模块开发前需进行详细设计评审
- 保持与UI/UX设计的同步，确保功能与界面的一致性
- 定期进行性能测试，特别是AI功能的响应时间和资源占用
- 优先实现核心功能，确保基本使用体验，再逐步添加高级功能

## 计划步骤（1.0.0之后）

### 25. 协作功能
- [ ] 设计多用户协作架构
- [ ] 实现实时协作编辑
- [ ] 实现版本控制与差异对比
- [ ] 创建评论与批注功能
- [ ] 实现权限管理系统

### 26. 扩展插件系统
- [ ] 设计插件架构
- [ ] 创建插件API
- [ ] 实现插件加载和管理机制
- [ ] 开发示例插件
- [ ] 创建插件市场

### 27. 参考资料管理功能
- [ ] 设计参考资料的数据模型（支持文本、图片、链接等多类型资料）
- [ ] 实现参考资料的增删改查（CRUD）功能
- [ ] 支持资料分类、标签和检索
- [ ] 集成资料与小说、章节、人物等实体的关联
- [ ] 开发参考资料的导入导出功能
- [ ] 创建参考资料管理界面（支持多视图、预览等）
- [ ] 优化资料展示与搜索体验

### 28. 设定管理功能
- [ ] 设计设定（世界观、规则、历史等）数据模型
- [ ] 实现设定的增删改查（CRUD）功能
- [ ] 支持设定分层、分组与标签管理
- [ ] 集成设定与小说、章节、人物、地点等实体的关联
- [ ] 开发设定内容的版本管理与变更追踪
- [ ] 创建设定管理界面（支持结构化与富文本编辑）
- [ ] 优化设定的展示、引用与检索体验

### 29. 小说世界知识图谱
- [ ] 设计知识图谱模型和关系类型
- [ ] 实现实体与关系提取服务
- [ ] 创建图谱可视化与交互组件
- [ ] 开发基于图谱的推理与查询功能
- [ ] 实现知识图谱的自动更新与扩展

### 30. 移动端同步
- [ ] 设计移动端应用架构
- [ ] 开发内容同步机制
- [ ] 创建移动端编辑器
- [ ] 实现跨设备体验一致性
- [ ] 开发离线工作模式

## 修订后的下一步工作计划（1.0版本前）

1. 完成人物、地点、大纲和时间线的向量化
   - 实现各类实体的向量表示
   - 确保向量索引的自动更新
   - 优化多实体类型的索引管理

2. 开发基础Agent框架
   - 设计并实现Agent核心架构
   - 创建编辑Agent和风格Agent原型
   - 实现Agent间的基础通信机制

3. 增强内容生成功能
   - 改进差异比较引擎
   - 升级续写服务
   - 增强内容修改与润色能力

4. 实现上下文增强系统
   - 开发上下文增强服务
   - 创建智能上下文筛选机制
   - 实现内联编辑建议功能

5. 强化内容一致性检查
   - 实现角色一致性检查
   - 实现情节逻辑一致性检查
   - 创建一致性问题管理界面

6. 完成应用打包和安装优化
   - 减小安装包体积
   - 简化安装流程
   - 添加基础自动更新机制

7. 编写核心功能文档
   - 创建基础用户手册
   - 制作关键功能介绍视频
   - 编写常见问题解答

8. 进行版本1.0发布准备
   - 全面测试与bug修复
   - 用户体验优化
   - 准备发布说明和发布计划

## 长期开发规划

根据新的项目设计文档，我们采用五阶段开发策略：

**第一阶段：基础框架（已完成）**
- 基础编辑器
- 小说项目管理
- 基础文件操作
- 核心架构设计

**第二阶段：创作工具（已完成）**
- 创作工具集（人物、地点、大纲等）
- 统计分析功能
- 基础插件系统
- 用户界面完善

**第三阶段：AI基础功能（进行中）**
- AI服务连接架构（已完成）
- 向量化系统（部分完成）
- 内容分析基础功能（计划中）
- 内联编辑建议（计划中）

**第四阶段：AI高级功能（计划中）**
- Agent系统框架
- 预设Agent实现
- 续写与润色功能增强
- 创作辅助工具扩展

**第五阶段：扩展与优化（计划中）**
- 自定义Agent与工作链
- 高级插件系统
- 性能优化
- 用户体验改进

根据开发进度和用户反馈，各阶段可能会有所调整和重叠。 