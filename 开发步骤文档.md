# 小说辅助创作工具开发步骤文档

本文档记录项目开发的主要步骤和进度。

## 已完成步骤

### 1. 项目初始化与基础架构
- [x] 创建Electron项目
- [x] 配置React前端环境
- [x] 设置TypeScript
- [x] 配置webpack构建系统
- [x] 实现主进程和渲染进程通信

### 2. 数据库设计与实现
- [x] 设计数据库结构
- [x] 实现数据库管理器
- [x] 创建数据表和初始化脚本
- [x] 实现数据CRUD操作

### 3. 小说管理功能
- [x] 实现小说创建、编辑、删除功能
- [x] 实现小说列表展示
- [x] 实现小说导入导出功能
- [x] 实现小说详情页

### 4. 章节管理功能
- [x] 实现章节创建、编辑、删除功能
- [x] 实现章节树形结构展示
- [x] 实现章节拖拽排序
- [x] 实现章节合并和拆分功能

### 5. 富文本编辑器
- [x] 集成Draft.js编辑器
- [x] 实现基本文本编辑功能
- [x] 实现格式化工具栏
- [x] 实现内容保存和加载

### 6. 创作辅助工具
- [x] 实现人物管理功能
- [x] 实现地点管理功能
- [x] 实现大纲管理功能
- [x] 实现时间线管理功能

### 7. 实体关联系统
- [x] 实现小说与人物关联
- [x] 实现小说与地点关联
- [x] 实现小说与大纲关联
- [x] 实现小说与时间线关联
- [x] 实现编辑器侧边栏展示关联内容

### 8. 数据备份与恢复
- [x] 实现数据库备份功能
- [x] 实现资源文件备份功能
- [x] 实现数据恢复功能
- [x] 创建备份管理界面

### 9. 统计分析功能
- [x] 实现小说总体统计
- [x] 实现写作进度分析
- [x] 实现写作活动分析
- [x] 创建统计分析可视化界面

### 10. AI功能集成
- [x] 集成OpenAI API
- [x] 集成DeepSeek API
- [x] 集成Ollama本地模型
- [x] 集成LM Studio本地模型
- [x] 实现OpenAI兼容API支持
- [x] 创建AI设置界面
- [x] 实现AI聊天助手
- [x] 实现编辑器AI辅助功能
- [x] 创建提示词管理系统
- [x] 实现文本差异对比功能
- [x] 实现AI场景配置系统

### 11. 界面优化
- [x] 优化主界面布局和导航
- [x] 优化小说管理界面
- [x] 优化编辑器界面
- [x] 优化创作工具界面
- [x] 优化AI助手界面
- [x] 优化文本差异对比组件
  - [x] 改进视觉设计，使用卡片式布局
  - [x] 添加差异统计功能，显示新增和删除的字符数及百分比
  - [x] 优化空状态和无变化状态的展示
  - [x] 添加文本差异总结信息
- [x] 优化创作提示词组件
  - [x] 添加高级筛选功能，支持按分类和标签筛选
  - [x] 改进搜索功能，提供更直观的结果展示
  - [x] 使用响应式网格布局展示提示词卡片
  - [x] 优化提示词卡片设计，添加悬停效果和操作按钮
  - [x] 改进空状态展示和用户引导
  - [x] 增强表单体验，添加字数统计和提示信息
- [x] 统一应用界面风格和交互模式

### 12. 性能优化
- [x] 优化富文本编辑器性能
- [x] 优化大型小说文件加载性能
- [x] 优化AI响应速度和稳定性
- [x] 优化应用启动时间

### 13. AI助手优化
- [x] 优化AI设置界面
  - [x] 修复OpenAI兼容API设置中的重复默认模型字段问题
  - [x] 添加配置命名功能，便于识别多个配置
  - [x] 改进界面布局，使其更加直观
  - [x] 完善表单验证和提示
- [x] 优化AI助手页面
  - [x] 重新设计聊天界面，提升整体交互体验
  - [x] 添加快捷键支持(Enter发送/Shift+Enter换行)
  - [x] 优化提示词库访问方式
  - [x] 改进加载状态的视觉反馈
- [x] 优化编辑器AI面板
  - [x] 简化面板界面，减少视觉干扰
  - [x] 添加操作说明，使功能更清晰
  - [x] 改进AI响应的展示方式，使用卡片式布局
  - [x] 增强错误处理和用户提示
- [x] 文本差异对比组件优化
  - [x] 增强视觉效果，改善样式
  - [x] 添加差异统计信息(增删字符数)
  - [x] 使用更清晰的颜色标记和布局

### 14. 富文本编辑器性能优化
- [x] 创建编辑器性能优化工具类
  - [x] 实现防抖自动保存功能
  - [x] 开发大型文档分块加载机制
  - [x] 实现编辑器性能优化函数
  - [x] 添加字数统计和token估算功能
- [x] 优化编辑器服务
  - [x] 重构编辑器服务，集成分块加载和性能优化
  - [x] 改进自动保存机制，减少保存操作频率
  - [x] 优化内容加载过程，添加进度反馈
- [x] 编辑器渲染优化
  - [x] 创建基于虚拟化的编辑器组件
  - [x] 实现滚动优化，减少不必要的重渲染
  - [x] 优化大型文档的编辑流畅度

### 15. AI响应速度和稳定性优化
- [x] 创建AI请求队列系统
  - [x] 实现请求队列和优先级管理
  - [x] 添加请求超时控制机制
  - [x] 实现自动重试和错误恢复功能
- [x] 优化聊天上下文管理
  - [x] 创建聊天上下文管理器
  - [x] 实现智能历史消息压缩
  - [x] 添加Token使用优化功能
  - [x] 实现基于场景的Token限制管理
- [x] 集成优化功能
  - [x] 重构聊天服务，集成请求队列和上下文管理
  - [x] 优化响应流式传输，提高稳定性
  - [x] 改进错误处理机制，增强用户体验

## 进行中步骤

### 16. 向量化索引与上下文增强
- [x] 选择合适的向量数据库
  - [x] 调研并评估Chroma、Milvus和pgvector等向量数据库
  - [x] 验证对Electron桌面应用的兼容性
  - [x] 测试嵌入式部署和性能分析
  - [x] 完成向量数据库选型报告，确定采用Chroma
- [ ] 实现内容向量化系统
  - [ ] 创建向量化服务核心架构
  - [ ] 实现文本分块和处理策略
  - [ ] 集成词向量嵌入服务
  - [ ] 添加本地嵌入模型支持
  - [ ] 添加OpenAI/DeepSeek嵌入API支持
  - [ ] 实现向量化任务队列和进度跟踪
- [ ] 实现小说内容的向量化索引
  - [ ] 为每个章节创建向量化表示
  - [ ] 为章节中的场景和对话创建独立向量
  - [ ] 实现自动更新机制，在内容改变时更新向量
  - [ ] 创建向量缓存系统，提升查询性能
- [ ] 实现人物、地点、大纲和时间线的向量化
  - [ ] 为人物属性和描述创建向量表示
  - [ ] 为地点属性和描述创建向量表示
  - [ ] 为大纲节点创建向量表示
  - [ ] 为时间线事件创建向量表示
  - [ ] 实现向量特征的自动更新机制
- [ ] 设计基于相似度的上下文检索系统
  - [ ] 创建统一的向量检索接口
  - [ ] 实现基于语义相似度的检索服务
  - [ ] 添加混合检索策略（关键词+语义）
  - [ ] 创建上下文检索UI组件
  - [ ] 优化检索速度与准确性
- [ ] 实现AI上下文增强功能
  - [ ] 创建上下文增强服务架构
  - [ ] 实现智能上下文筛选与整合
  - [ ] 设计上下文压缩与转换策略
  - [ ] 开发上下文框架格式化器
  - [ ] 构建上下文提取与摘要服务
- [ ] 创建智能问答系统
  - [ ] 设计问答系统架构
  - [ ] 实现问题分析与意图识别
  - [ ] 创建基于向量和结构的混合检索
  - [ ] 开发答案生成与排序机制
  - [ ] 添加上下文追踪与多轮对话支持
- [ ] 实现内容一致性检查
  - [ ] 设计一致性检查规则引擎
  - [ ] 实现基础检查（人物、地点、时间线）
  - [ ] 开发高级检查（情节逻辑、矛盾检测）
  - [ ] 创建一致性报告与可视化工具
  - [ ] 添加智能修复建议功能
- [ ] 构建小说世界知识图谱
  - [ ] 设计知识图谱模型和关系类型
  - [ ] 实现实体与关系提取服务
  - [ ] 创建图谱可视化与交互组件
  - [ ] 开发基于图谱的推理与查询功能
  - [ ] 实现知识图谱的自动更新与扩展

### 17. Embedding模型实现
- [ ] 调研和选择本地Embedding模型
  - [ ] 评估轻量级Embedding模型（如SBERT变体、FastText、GloVe等）
  - [ ] 测试模型在不同语言上的性能，特别是中文
  - [ ] 创建模型评估报告，比较嵌入质量和处理速度
  - [ ] 选择最适合桌面应用的模型
- [ ] 实现Embedding服务架构
  - [ ] 设计统一的Embedding服务接口
  - [ ] 创建模型加载和管理机制
  - [ ] 实现批处理和缓存优化
  - [ ] 开发多线程处理框架，防止UI阻塞
  - [ ] 设计向量存储和索引结构
- [ ] 文本预处理系统
  - [ ] 实现智能分块算法，优化语义完整性
  - [ ] 创建自适应分块大小机制，基于内容复杂度
  - [ ] 实现预处理管道（清洗、分词、规范化）
  - [ ] 添加中文特定的处理规则
  - [ ] 开发关键信息提取和权重分配算法
- [ ] 高级向量检索功能
  - [ ] 实现混合检索策略（BM25+向量相似度）
  - [ ] 创建重排序和结果优化算法
  - [ ] 开发上下文感知检索，考虑查询上下文
  - [ ] 实现语义过滤和聚类功能
  - [ ] 添加个性化检索偏好设置

### 18. Agent架构实现
- [ ] 设计Agent系统架构
  - [ ] 创建Agent框架基础结构
  - [ ] 定义Agent接口和通信协议
  - [ ] 设计工具和操作库
  - [ ] 实现Agent状态管理系统
  - [ ] 创建调度和控制机制
- [ ] 开发专用Agent组件
  - [ ] 实现编辑助手Agent（提供写作指导和编辑建议）
  - [ ] 创建研究Agent（收集和组织创作相关资料）
  - [ ] 开发角色分析Agent（分析和维护角色一致性）
  - [ ] 实现情节顾问Agent（提供情节发展和结构建议）
  - [ ] 构建世界构建Agent（协助创建和维护小说世界设定）
- [ ] 创建Agent工具集
  - [ ] 向量数据库检索工具
  - [ ] 文本分析和摘要工具
  - [ ] 关系图谱查询和推理工具
  - [ ] 数据库操作和更新工具
  - [ ] 外部知识查询工具（可选，如维基百科接口）
- [ ] 实现Agent协作系统
  - [ ] 设计多Agent协作框架
  - [ ] 创建任务分解和分配机制
  - [ ] 实现结果整合和冲突解决
  - [ ] 开发用户反馈整合机制
  - [ ] 构建Agent性能监控和优化系统
- [ ] Agent与用户界面集成
  - [ ] 设计Agent交互界面
  - [ ] 创建Agent行动可视化组件
  - [ ] 实现用户指令输入和偏好设置界面
  - [ ] 开发Agent输出展示和交互组件
  - [ ] 添加Agent调试和定制工具

### 19. 跨平台兼容性
- [ ] Windows平台测试与修复
- [ ] macOS平台测试与修复
- [ ] Linux平台测试与修复
- [ ] 不同屏幕分辨率适配优化

### 20. 应用打包与安装
- [x] 优化应用打包流程
- [ ] 减小安装包体积
- [ ] 简化安装过程
- [ ] 创建自动更新机制

### 21. 用户文档
- [ ] 编写用户使用手册
- [ ] 创建功能介绍视频
- [ ] 编写常见问题解答
- [ ] 创建在线帮助系统

## 计划步骤（1.0.0之后）

### 22. 协作功能
- [ ] 设计多用户协作架构
- [ ] 实现实时协作编辑
- [ ] 实现版本控制与差异对比
- [ ] 创建评论与批注功能
- [ ] 实现权限管理系统

### 23. 扩展插件系统
- [ ] 设计插件架构
- [ ] 创建插件API
- [ ] 实现插件加载和管理机制
- [ ] 开发示例插件
- [ ] 创建插件市场

## 下一步工作计划

1. 完成性能优化工作
   - 优化富文本编辑器性能，提高大型文档的编辑流畅度
   - 优化AI响应速度，减少等待时间
   - 改进应用资源管理，减少内存占用

2. 进行全面的兼容性测试
   - 在不同操作系统上测试应用功能
   - 测试不同屏幕尺寸下的界面适配
   - 解决发现的兼容性问题

3. 完成应用打包与安装优化
   - 优化打包脚本，减小安装包体积
   - 简化安装流程，提高用户体验
   - 实现基本的自动更新机制

4. 编写用户文档
   - 创建详细的用户使用手册
   - 制作关键功能的介绍视频
   - 编写常见问题解答

5. 准备1.0.0版本发布
   - 进行最终测试和bug修复
   - 准备发布说明
   - 创建发布计划

6. 开始实现向量化和Agent功能
   - 研究并选择合适的向量数据库
   - 设计及实现本地Embedding模型集成
   - 开发基础Agent架构
   - 创建核心Agent组件和工具集 